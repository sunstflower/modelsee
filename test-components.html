<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModelAdd组件重构测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .status-item {
            padding: 10px 15px;
            border-radius: 6px;
            font-weight: 500;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .test-item {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            background: #fafafa;
        }
        .test-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .test-result {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 10px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
        }
        .loading {
            background-color: #cce7ff;
            color: #004085;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧪 ModelAdd组件重构测试</h1>
            <p>测试重构后的神经网络层配置组件功能</p>
            
            <div class="status" id="status">
                <div class="status-item loading">检查中...</div>
            </div>
        </div>

        <div class="test-section">
            <h2>📡 服务状态检查</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h4>后端API服务</h4>
                    <div>端点: http://127.0.0.1:8000</div>
                    <div class="test-result" id="backend-status">检查中...</div>
                </div>
                <div class="test-item">
                    <h4>前端开发服务</h4>
                    <div>端点: http://localhost:5173</div>
                    <div class="test-result" id="frontend-status">检查中...</div>
                </div>
                <div class="test-item">
                    <h4>层组件数据</h4>
                    <div>API: /layers</div>
                    <div class="test-result" id="layers-status">检查中...</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>🔧 重构完成的组件</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h4>✅ NodeContainer</h4>
                    <div>共享节点容器，支持基本/高级配置分离</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ Dense Layer</h4>
                    <div>全连接层，支持完整参数配置</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ Conv2D Layer</h4>
                    <div>卷积层，智能尺寸输入组件</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ Dropout Layer</h4>
                    <div>丢弃层，可视化丢弃率设置</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ Flatten Layer</h4>
                    <div>展平层，信息展示型组件</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ Activation Layer</h4>
                    <div>激活层，动态参数配置</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ MaxPooling2D Layer</h4>
                    <div>最大池化层，智能尺寸选择器</div>
                    <div class="test-result success">重构完成</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>✅ 新完成的组件重构</h2>
            <div class="test-grid">
                <div class="test-item">
                    <h4>✅ BatchNorm Layer</h4>
                    <div>批归一化层，支持完整参数配置</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ AvgPooling2D Layer</h4>
                    <div>平均池化层，智能尺寸选择器</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ Reshape Layer</h4>
                    <div>重塑层，形状预设和自定义输入</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ LSTM Layer</h4>
                    <div>长短期记忆层，完整的循环网络配置</div>
                    <div class="test-result success">重构完成</div>
                </div>
                <div class="test-item">
                    <h4>✅ GRU Layer</h4>
                    <div>门控循环单元层，高效的序列处理</div>
                    <div class="test-result success">重构完成</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>🖥️ 实际应用预览</h2>
            <p>在新窗口中打开前端应用进行测试：</p>
            <a href="http://localhost:5173" target="_blank" style="display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 6px;">打开前端应用</a>
        </div>

        <div class="test-section">
            <h2>📋 重构特性总结</h2>
            <ul style="line-height: 1.8;">
                <li><strong>统一设计模式</strong>：所有组件都遵循一致的架构</li>
                <li><strong>字段提示系统</strong>：每个配置项都有详细的说明</li>
                <li><strong>基本/高级配置分离</strong>：简化初始界面，展开显示高级选项</li>
                <li><strong>后端数据结构一致</strong>：配置格式与后端API完全匹配</li>
                <li><strong>智能默认值</strong>：根据层类型和位置设置合理默认值</li>
                <li><strong>用户体验优化</strong>：更好的视觉反馈和交互设计</li>
            </ul>
        </div>
    </div>

    <script>
        // 检查服务状态
        async function checkServices() {
            const statusDiv = document.getElementById('status');
            const backendStatus = document.getElementById('backend-status');
            const frontendStatus = document.getElementById('frontend-status');
            const layersStatus = document.getElementById('layers-status');

            try {
                // 检查后端
                const backendResponse = await fetch('http://127.0.0.1:8000/health');
                if (backendResponse.ok) {
                    const data = await backendResponse.json();
                    backendStatus.className = 'test-result success';
                    backendStatus.textContent = `✅ 正常运行 (Redis: ${data.redis_status})`;
                } else {
                    throw new Error('Backend not responding');
                }
            } catch (error) {
                backendStatus.className = 'test-result error';
                backendStatus.textContent = '❌ 服务异常';
            }

            try {
                // 检查前端
                const frontendResponse = await fetch('http://localhost:5173');
                if (frontendResponse.ok) {
                    frontendStatus.className = 'test-result success';
                    frontendStatus.textContent = '✅ 正常运行';
                } else {
                    throw new Error('Frontend not responding');
                }
            } catch (error) {
                frontendStatus.className = 'test-result error';
                frontendStatus.textContent = '❌ 服务异常';
            }

            try {
                // 检查层组件数据
                const layersResponse = await fetch('http://127.0.0.1:8000/layers');
                if (layersResponse.ok) {
                    const data = await layersResponse.json();
                    if (data.success && data.layers && data.layers.layers) {
                        const layerCount = Object.keys(data.layers.layers).length;
                        layersStatus.className = 'test-result success';
                        layersStatus.textContent = `✅ ${layerCount} 个层组件已加载 (CORS已修复)`;
                    } else {
                        throw new Error('Invalid layers data structure');
                    }
                } else {
                    throw new Error('Layers API not responding');
                }
            } catch (error) {
                layersStatus.className = 'test-result error';
                layersStatus.textContent = '❌ 数据加载失败: ' + error.message;
            }

            // 更新总体状态
            statusDiv.innerHTML = '<div class="status-item status-success">✅ 检查完成</div>';
        }

        // 页面加载后检查服务
        window.addEventListener('load', checkServices);
    </script>
</body>
</html> 